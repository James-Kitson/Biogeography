---
title: "Appendix S4: Statistical Analyses for Kitson *et al.* 2016"
output: 
    pdf_document:
      latex_engine: xelatex
header-includes:
  - \usepackage{xcolor}
mainfont: Cambria
fontsize: 12pt
toc: true
urlcolor: blue
---

```{r setup, include=FALSE}
require(knitr)
knitr::opts_chunk$set(echo = FALSE,
                      warning=FALSE,
                      message=FALSE,
                      dev = 'pdf',
                      fig.align='center')
```
\newpage
#Outline
The purpose of this Rmarkdown document is to allow users to follow our statistical analyses for both the plotting of biogeographic analysis results and the subsequent statistics performed on node ages. Analyses are performed using separate R scripts called by this document and users should refer to the unrendered [Cratopus_statistical_SI.Rmd](https://github.com/James-Kitson/Biogeography/blob/master/Cratopus_statistical_SI.Rmd) file for links to the relevant scripts.

```{r echo=FALSE}
read_chunk('R_scripts/RASPBBM_node_age_stats.R')
```
```{r}
<<processdata1>>
```
#Statistical analysis of node ages
For each of the statistical analyses outlined in the main manuscript (except for where explicitly noted) we have taken a bootstrapping approach that allows us to compare the mean age of our nodes of interest (*i.e.* a comparison of colonisation node ages across islands, *in situ* speciation nodes vs colonisation node ages for each island and flight loss nodes vs all other nodes) to an equally sized subset of the remaining nodes in each analysis resampled `r iter` times. In each iteration, any given node was only sampled once and in each histogram, the vertical red line indicates the mean or single value that the resampled node ages are being tested against.
\newpage

#S4.1 Node age statstics based on the ancestral state estimation using Bayesian Binary Markov analysis in RASP.
##S4.1.1 RASP BBM ancestral state reconstruction.
```{r echo=FALSE}
read_chunk('R_scripts/BBM_biogeography.R')
```
```{r fig.width=7, fig.height=9, message=F, warning=F}
<<BBMtreeprocess>>
<<BBMtreeplot>>
```
\newpage
From the previous plot we can group nodes as indicated in the legend.
```{r fig.width=7, fig.height=9, message=F, warning=F}
<<BBMstatsnodes>>
```

\newpage
```{r echo=FALSE}
read_chunk('R_scripts/RASPBBM_node_age_stats.R')
```
```{r}
<<processdata1>>
<<processdata2>>
```
##S4.1.2 Comparing the average age of colonisation nodes on Réunion to those Mauritius
```{r}
<<BBMMauvsReu>>
<<BBMMauvsReuttest>>
```
The age of nodes leading to colonisations of Mauritius (*mean age* = `r round(BBMMauvsReu.test$null.value,2)` mya) is significantly less than nodes leading to colonisations of Réunion (*mean age* = `r round(BBMMauvsReu.test$estimate,2)` mya, *95% CI* = `r round(BBMMauvsReu.test$conf.int[1],2)` mya - `r round(BBMMauvsReu.test$conf.int[2],2)` mya, *t* = `r round(BBMMauvsReu.test$statistic,2)`, *df* = `r round(BBMMauvsReu.test$parameter,2)`, *p* `r ifelse(BBMMauvsReu.test$p.value < 0.0001,"< 0.0001", paste("= ", round(BBMMauvsReu.test$p.value,2), sep=""))`)

\newpage
```{r}
<<processdata4>>
```
##S4.1.3 Comparing the age of colonisation events on Mauritius to *in situ* speciation events
This is reversed relative to the test performed on Réunion nodes as there are many more *in situ* speciation nodes on Mauritius than colonisations.

```{r}
<<BBMinsituMau>>
<<BBMinsituMauttest>>
```

Here we can see that nodes leading to colonisations of Mauritius (*mean age* = `r round(BBMMauinsitu.test$null.value,2)` mya) are significantly younger than *in situ* speciation events (*mean age* = `r round(BBMMauinsitu.test$estimate,2)` mya, *95% CI* = `r round(BBMMauinsitu.test$conf.int[1],2)` mya - `r round(BBMMauinsitu.test$conf.int[2],2)` mya, *t* = `r round(BBMMauinsitu.test$statistic,2)`, *df* = `r round(BBMMauinsitu.test$parameter,2)`, *p* `r ifelse(BBMMauinsitu.test$p.value < 0.0001,"< 0.0001",paste ("= ", round(BBMMauinsitu.test$p.value,2), sep=""))`)

\newpage
```{r}
<<processdata3>>
```
##S4.1.4 Comparing the age of *in situ* speciation events on Réunion to colonisation events
```{r}
<<BBMinsituReu>>
```
As there are exactly the same number of colonisation and *in situ* speciation events inferred for Réunion, resampling does not make sense as it will repeatedly return the same mean value. A more apropriate test in this situation is the age of all colonisation nodes vs all *in situ* speciation nodes.
```{r}
<<BBMinsituReuttest>>
```

Colonisations of Réunion (*mean age* = `r round(BBMReuinsitu.test$estimate[2],2)` mya, *sd* = `r round(sd(Reu.col$Median_age),2)`) are not significantly different in age to *in situ* speciation nodes on Réunion (*mean age* = `r round(BBMReuinsitu.test$estimate[1],2)` mya, *sd* = `r round(sd(Reu.insitu$Median_age),2)`, *t* = `r round(BBMReuinsitu.test$statistic,2)`, *df* = `r round(BBMReuinsitu.test$parameter,2)`, *p* `r ifelse(BBMReuinsitu.test$p.value < 0.0001,"< 0.0001",paste ("= ", round(BBMReuinsitu.test$p.value,2), sep=""))`)

\newpage

##S4.1.5 Comparing the age of flight loss nodes to nodes without flight loss

```{r}
<<BBMflightloss>>
<<BBMflightlossttest>>
```

Nodes leading to flight loss (*mean age* = `r round(BBMfl.test$null.value,2)` mya) are significantly younger than other nodes (*mean age* = `r round(BBMfl.test$estimate,2)` mya, *95% CI* = `r round(BBMfl.test$conf.int[1],2)` mya - `r round(BBMfl.test$conf.int[2],2)` mya, *t* = `r round(BBMfl.test$statistic,2)`, *df* = `r round(BBMfl.test$parameter,2)`, *p* `r ifelse(BBMfl.test$p.value < 0.0001,"< 0.0001",paste ("= ", round(BBMfl.test$p.value,2), sep=""))`)

\newpage

#S4.2 Node age statstics based on the ancestral state estimation using Maximum Likelihood analyses in R.
##S4.2.1 R Maximum Likelihood ancestral state reconstruction.
```{r echo=FALSE}
read_chunk('R_scripts/ML_biogeography.R')
```
```{r fig.width=7, fig.height=9, message=F, warning=F}
<<MLtreeprocess>>
<<MLtreeplot>>
```
\newpage
From the previous plot we can group nodes as indicated in the legend.
```{r fig.width=7, fig.height=9, message=F, warning=F}
<<RMLstatsnodes>>
```

\newpage
```{r echo=FALSE}
read_chunk('R_scripts/RML_node_age_stats.R')
```
```{r}
<<processdata5>>
<<processdata6>>
```
##S4.2.2 Comparing the average age of colonisation nodes on Réunion to those Mauritius
```{r}
<<RMLMauvsReu>>
```
As can be seen here, with only one colonisation of Mauritius from Réunion inferred, the script repeatedly samples single node ages, a more appropriate test in this instance is all Réunion colonisations vs the age of the single Mauritian colonisation.
```{r}

<<RMLMauvsReuttest>>
```

The age of the single colonisation of Mauritius (`r round(RMLMauvsReu.test$null.value,2)` mya) is significantly less than nodes leading to colonisations of Réunion (*mean age* = `r round(RMLMauvsReu.test$estimate,2)` mya, *95% CI* = `r round(RMLMauvsReu.test$conf.int[1],2)` mya - `r round(RMLMauvsReu.test$conf.int[2],2)` mya, *t* = `r round(RMLMauvsReu.test$statistic,2)`, *df* = `r round(RMLMauvsReu.test$parameter,2)`, *p* `r ifelse(RMLMauvsReu.test$p.value < 0.0001,"< 0.0001", paste("= ", round(RMLMauvsReu.test$p.value,2), sep=""))`)

\newpage
```{r}
<<processdata8>>
```
##S4.2.3 Comparing the age of colonisation events on Mauritius to *in situ* speciation events
This is reversed relative to the test performed on Réunion nodes as there are many more *in situ* speciation nodes on Mauritius than colonisations.
```{r}
<<RMLinsituMau>>
```
As with the t-test for Réunion vs Mauritian colonisation ages there is only one colonisation of Mauritius from Réunion inferred. So once again, a more appropriate test is the age of all Mauritian *in situ* speciation nodes vs the age of the single Mauritian colonisation.
```{r}
<<RMLinsituMauttest>>
```

Here we can see that the single colonisation of Mauritius (`r round(RMLMauinsitu.test$null.value,2)` mya) is significantly younger than the *in situ* speciation events on Mauritius (*mean age* = `r round(RMLMauinsitu.test$estimate,2)` mya, *95% CI* = `r round(RMLMauinsitu.test$conf.int[1],2)` mya - `r round(RMLMauinsitu.test$conf.int[2],2)` mya, *t* = `r round(RMLMauinsitu.test$statistic,2)`, *df* = `r round(RMLMauinsitu.test$parameter,2)`, *p* `r ifelse(RMLMauinsitu.test$p.value < 0.0001,"< 0.0001",paste ("= ", round(RMLMauinsitu.test$p.value,2), sep=""))`)

\newpage  
```{r}
<<processdata7>>
```
##S4.2.4 Comparing the age of *in situ* speciation events on Réunion to colonisation events
```{r}
<<RMLinsituReu>>
<<RMLinsituReuttest>>
```

*In situ* speciation events on Réunion (*mean age* = `r round(RMLReuinsitu.test$null.value,2)` mya) are significantly younger than colonisation events on Réunion (*mean age* = `r round(RMLReuinsitu.test$estimate,2)` mya, *95% CI* = `r round(RMLReuinsitu.test$conf.int[1],2)` mya - `r round(RMLReuinsitu.test$conf.int[2],2)` mya, *t* = `r round(RMLReuinsitu.test$statistic,2)`, *df* = `r round(RMLReuinsitu.test$parameter,2)`, *p* `r ifelse(RMLReuinsitu.test$p.value < 0.0001,"< 0.0001",paste ("= ", round(RMLReuinsitu.test$p.value,2), sep=""))`)

\newpage
##S4.2.5 Comparing the age of flight loss nodes to nodes without flight loss
```{r}
<<RMLflightloss>>
<<RMLflightlossttest>>
```

Nodes leading to flight loss (*mean age* = `r round(RMLfl.test$null.value,2)` mya) are significantly younger than other nodes (*mean age* = `r round(RMLfl.test$estimate,2)` mya, *95% CI* = `r round(RMLfl.test$conf.int[1],2)` mya - `r round(RMLfl.test$conf.int[2],2)` mya, *t* = `r round(RMLfl.test$statistic,2)`, *df* = `r round(RMLfl.test$parameter,2)`, *p* `r ifelse(RMLfl.test$p.value < 0.0001,"< 0.0001",paste ("= ", round(RMLfl.test$p.value,2), sep=""))`)
\newpage
\eject \pdfpagewidth=400mm \pdfpageheight=210mm

|   Island   |      Morphospecies      | Island group |   Island  |      Morphospecies      | Island group |      Island      |       Morphospecies      | Island group |
|:----------:|:-----------------------:|:------------:|:---------:|:-----------------------:|:------------:|:----------------:|:------------------------:|:------------:|
| La Réunion |   Cratopopsis alluaudi  |  Mascarenes  | Mauritius | Cratopopsis mauritianus |  Mascarenes  |     Rodrigues    |   Cratopopsis pauliani   |  Mascarenes  |
| La Réunion |   Cratopopsis bistigma  |  Mascarenes  | Mauritius |  Cratopopsis impressus  |  Mascarenes  |     Rodrigues    |    Cratopus inornatus    |  Mascarenes  |
| La Réunion |  Cratopopsis coquereli  |  Mascarenes  | Mauritius |   Cratopus aeneoniger   |  Mascarenes  |     Rodrigues    |      Cratopus rocki      |  Mascarenes  |
| La Réunion |   Cratopopsis cribatus  |  Mascarenes  | Mauritius |     Cratopus armatus    |  Mascarenes  |     Rodrigues    |    Cratopus virescens    |  Mascarenes  |
| La Réunion | Cratopopsis fulvicornis |  Mascarenes  | Mauritius |   Cratopus caliginosus  |  Mascarenes  |     Rodrigues    | Cratopus viridipunctatus |  Mascarenes  |
| La Réunion | Cratopopsis nitidifrons |  Mascarenes  | Mauritius |     Cratopus cariei     |  Mascarenes  |      Aldabra     |  Cratopus griseovestitus |  Seychelles  |
| La Réunion |   Cratopopsis obscurus  |  Mascarenes  | Mauritius |    Cratopus confusus    |  Mascarenes  |      Aldabra     |  Cratopus viridisparsus  |  Seychelles  |
| La Réunion |  Cratopopsis villosulus |  Mascarenes  | Mauritius |    Cratopus deceptus    |  Mascarenes  |   Aride Island   |  Cratopus griseovestitus |  Seychelles  |
| La Réunion |     Cratopus bernei     |  Mascarenes  | Mauritius |   Cratopus emarginatus  |  Mascarenes  |   Cousin Island  |  Cratopus griseovestitus |  Seychelles  |
| La Réunion |   Cratopus angustatus   |  Mascarenes  | Mauritius |    Cratopus fasciger    |  Mascarenes  |  Cousine Island  |  Cratopus griseovestitus |  Seychelles  |
| La Réunion |  Cratopus circumcinctus |  Mascarenes  | Mauritius | Cratopus melanocephalus |  Mascarenes  |     La Digue     |   Cratopus aurostriatus  |  Seychelles  |
| La Réunion |   Cratopus ditissimus   |  Mascarenes  | Mauritius |     Cratopus molitor    |  Mascarenes  |     La Digue     |     Cratopus Dig_sp1     |  Seychelles  |
| La Réunion |   Cratopus exquisitus   |  Mascarenes  | Mauritius |    Cratopus mundulus    |  Mascarenes  |     La Digue     |  Cratopus griseovestitus |  Seychelles  |
| La Réunion |    Cratopus frappieri   |  Mascarenes  | Mauritius |     Cratopus murinus    |  Mascarenes  |       Mahe       |     Cratopus Mah sp1     |  Seychelles  |
| La Réunion |   Cratopus fulvescens   |  Mascarenes  | Mauritius |  Cratopus nigrogranatus |  Mascarenes  |      Praslin     |    Cratopus segregatus   |  Seychelles  |
| La Réunion |    Cratopus humeralis   |  Mascarenes  | Mauritius |     Cratopus nothus     |  Mascarenes  |    Silhouette    |  Cratopus griseovestitus |  Seychelles  |
| La Réunion |  Cratopus leucophaetus  |  Mascarenes  | Mauritius |     Cratopus ovalis     |  Mascarenes  |    Silhouette    |    Cratopus segregatus   |  Seychelles  |
| La Réunion |    Cratopus marmoreus   |  Mascarenes  | Mauritius |    Cratopus psittacus   |  Mascarenes  |      Anjouan     |    Cratopus AnjCom sp1   |    Comoros   |
| La Réunion |    Cratopus. murinus    |  Mascarenes  | Mauritius |     Cratopus punctum    |  Mascarenes  |      Anjouan     |    Cratopus AnjCom sp2   |    Comoros   |
| La Réunion |   Cratopus nigridorsis  |  Mascarenes  | Mauritius |    Cratopus stigmaeus   |  Mascarenes  |   Grande Comore  |     Cratopus GCom sp1    |    Comoros   |
| La Réunion | Cratopus septemvittatus |  Mascarenes  | Mauritius |     Cratopus striga     |  Mascarenes  |   Grande Comore  |   Cratopus subdenudatus  |    Comoros   |
| La Réunion |     Cratopus tristis    |  Mascarenes  | Mauritius |    Cratopus tigratus    |  Mascarenes  |      Mayotte     |    Cratopus ditissimus   |    Comoros   |
| La Réunion |    Scaevinus dombayae   |  Mascarenes  | Mauritius |   Cratopus variegatus   |  Mascarenes  |      Moheli      |    Cratopus MohCom sp1   |    Comoros   |
|            |                         |              | Mauritius | Cratopus viridilimbatus |  Mascarenes  |      Europa      |  Cratopus viridisparsus  |  Iles Eparse |
|            |                         |              | Mauritius |    Cratopus viridulus   |  Mascarenes  | Grande Glorieuse |    Cratopus gloriosus    |  Iles Eparse |
|            |                         |              | Mauritius |    Cratopus vulgaris    |  Mascarenes  |   Juan de Nova   |    Cratopus adspersus    |  Iles Eparse |
|            |                         |              | Mauritius |  Scaevinus subtruncatus |  Mascarenes  |    Madagascar    |   Polyclaeis equestris   |  Madagascar  |

\newpage