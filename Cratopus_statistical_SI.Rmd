---
title: "Statistical Analyses for Kitson *et al.* 2016"
author: '**James Kitson**'
header-includes:
   - \usepackage[final]{pdfpages}
output: 
    pdf_document:
      latex_engine: xelatex
mainfont: Cambria
toc: true
urlcolor: blue
---

```{r setup, include=FALSE}
require(knitr)
knitr::opts_chunk$set(echo = FALSE,
                      warning=FALSE,
                      message=FALSE,
                      dev = 'pdf',
                      fig.align='center')
```

#Outline
The purpose of this Rmarkdown document is to allow users to follow our statistical analyses for both the plotting of biogeogpahic analysis results and the subsequent statistics performed on node ages. Analyses are performed using separate R scripts called by this document and users should refer to the unrendered [Cratopus_statistical_SI.Rmd](https://github.com/James-Kitson/Biogeography/blob/master/Cratopus_statistical_SI.Rmd) file for links to the relevant scripts.

```{r echo=FALSE}
read_chunk('R_scripts/RASPBBM_node_age_stats.R')
```
```{r}
<<processdata1>>
```
#Statistical analysis of node ages
For each of the statistical analyses outlined in the main manuscript (except for where explicitly noted) we have taken a bootstrapping approach that allows us to compare the mean age of our nodes of interest (*i.e.* flight loss nodes, *in situ* speciation nodes, comparison of colonisation nodes across islands) to an equally sized subset of the remaining nodes in each analysis resampled `r iter` times. In each iteration, any given node was only sampled once.
\newpage

#Statistics from the Bayesian Binary Markov analysis in RASP.
##RASP BBM
```{r echo=FALSE}
read_chunk('R_scripts/BBM_biogeography.R')
```
```{r fig.width=7, fig.height=9.5, message=F, warning=F}
<<BBMtreeprocess>>
<<BBMtreeplot>>
```
\newpage
From the previous plot we can group nodes as indicated in the legend.
```{r fig.width=7, fig.height=9.5, message=F, warning=F}
<<BBMstatsnodes>>
```

\newpage
```{r echo=FALSE}
read_chunk('R_scripts/RASPBBM_node_age_stats.R')
```
```{r}
<<processdata1>>
<<processdata2>>
```
##Comparing the average node age on Reunion to Mauritius
```{r}
<<BBMMauvsReu>>
<<BBMMauvsReuttest>>
```
\newpage
```{r}
<<processdata4>>
```
##Comparing the age of colonisation events on Mauritius to *in situ* speciation events
This is reversed relative to the test performed on Reunion nodes as there are many more *in situ* speciation nodes on Mauritius than colonisations.

```{r}
<<BBMinsituMau>>
<<BBMinsituMauttest>>
```
\newpage
```{r}
<<processdata3>>
```
##Comparing the age of *in situ* speciation events on Reunion to colonisation events
```{r}
<<BBMinsituReu>>
```
As there are exactly the same number of colonisation and *in situ* speciation events inferred for Reunion, the resampling doesn't work and repeatedly returns the same mean value. A more apropriate test in this situation is the age of all colonisation nodes vs all *in situ* speciation nodes.
```{r}
<<BBMinsituReuttest>>
```
\newpage

##Comparing the age of flight loss nodes to nodes without flight loss

```{r}
<<BBMflightloss>>
<<BBMflightlossttest>>
```
\newpage
#Statistics from the Maximum Likelihood analyses in R.
##R Maximum Likelihood
```{r echo=FALSE}
read_chunk('R_scripts/ML_biogeography.R')
```
```{r fig.width=7, fig.height=9.5, message=F, warning=F}
<<MLtreeprocess>>
<<MLtreeplot>>
```
\newpage
From the previous plot we can group nodes as indicated in the legend.
```{r fig.width=7, fig.height=9.5, message=F, warning=F}
<<RMLstatsnodes>>
```

\newpage
```{r echo=FALSE}
read_chunk('R_scripts/RML_node_age_stats.R')
```
```{r}
<<processdata5>>
<<processdata6>>
```
##Comparing the average node age on Reunion to Mauritius
```{r}
<<RMLMauvsReu>>
```
As can be seen here, with only one colonisation of Mauritius from Reunion inferred, the script repeatedly samples single node ages, a more appropriate test in this instance is all Reunion colonisations vs the age of the single Mauritian colonisation.
```{r}

<<RMLMauvsReuttest>>
```
\newpage
```{r}
<<processdata8>>
```
##Comparing the age of colonisation events on Mauritius to *in situ* speciation events
This is reversed relative to the test performed on Reunion nodes as there are many more *in situ* speciation nodes on Mauritius than colonisations.
```{r}
<<RMLinsituMau>>
```
As with the t-test for Reunion vs Mauritian colonisation agesthere is only one colonisation of Mauritius from Reunion inferred. So once again, a more appropriate test is the age of all Mauritian *in situ* speciation nodes vs the age of the single Mauritian colonisation.
```{r}
<<RMLinsituMauttest>>
```
\newpage  
```{r}
<<processdata7>>
```
##Comparing the age of *in situ* speciation events on Reunion to colonisation events
```{r}
<<RMLinsituReu>>
<<RMLinsituReuttest>>
```
\newpage
##Comparing the age of flight loss nodes to nodes without flight loss
```{r}
<<RMLflightloss>>
<<RMLflightlossttest>>
```